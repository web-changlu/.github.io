"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(void 0).ColorThief=t()}(function(){function r(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height)}var d,m,y=y||{map:function(t,n){var r={};return n?t.map(function(t,o){return r.index=o,n.call(r,t)}):t.slice()},naturalOrder:function(t,o){return t<o?-1:o<t?1:0},sum:function(t,r){var e={};return t.reduce(r?function(t,o,n){return e.index=n,t+r.call(e,o)}:function(t,o){return t+o},0)},max:function(t,o){return Math.max.apply(null,o?y.map(t,o):t)}},e=(m=8-(d=5),_.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(t){var o=this.histo;if(!this._count_set||t){for(var n,r,e=0,i=this.r1;i<=this.r2;i++)for(n=this.g1;n<=this.g2;n++)for(r=this.b1;r<=this.b2;r++)e+=o[x(i,n,r)]||0;this._count=e,this._count_set=!0}return this._count},copy:function(){return new _(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(t){var o=this.histo;if(!this._avg||t){for(var n,r,e,i=0,u=1<<8-d,s=0,a=0,h=0,c=this.r1;c<=this.r2;c++)for(r=this.g1;r<=this.g2;r++)for(e=this.b1;e<=this.b2;e++)i+=n=o[x(c,r,e)]||0,s+=n*(c+.5)*u,a+=n*(r+.5)*u,h+=n*(e+.5)*u;this._avg=i?[~~(s/i),~~(a/i),~~(h/i)]:[~~(u*(this.r1+this.r2+1)/2),~~(u*(this.g1+this.g2+1)/2),~~(u*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(t){var o=t[0]>>m;return gval=t[1]>>m,bval=t[2]>>m,o>=this.r1&&o<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},C.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var o=this.vboxes,n=0;n<o.size();n++)if(o.peek(n).vbox.contains(t))return o.peek(n).color;return this.nearest(t)},nearest:function(t){for(var o,n,r,e=this.vboxes,i=0;i<e.size();i++)((n=Math.sqrt(Math.pow(t[0]-e.peek(i).color[0],2)+Math.pow(t[1]-e.peek(i).color[1],2)+Math.pow(t[2]-e.peek(i).color[2],2)))<o||void 0===o)&&(o=n,r=e.peek(i).color);return r},forcebw:function(){var t=this.vboxes;t.sort(function(t,o){return y.naturalOrder(y.sum(t.color),y.sum(o.color))});var o=t[0].color;o[0]<5&&o[1]<5&&o[2]<5&&(t[0].color=[0,0,0]);var n=t.length-1,o=t[n].color;251<o[0]&&251<o[1]&&251<o[2]&&(t[n].color=[255,255,255])}},function(t,o){if(!t.length||o<2||256<o)return!1;var n,r,s=(e=t,r=new Array(1<<3*d),e.forEach(function(t){n=x(t[0]>>m,t[1]>>m,t[2]>>m),r[n]=(r[n]||0)+1}),r);s.forEach(function(){});var e,i,u,a,h,c,f,l,e=(e=s,f=h=u=1e6,l=c=a=0,t.forEach(function(t){(i=t[0]>>m)<u?u=i:a<i&&(a=i),(i=t[1]>>m)<h?h=i:c<i&&(c=i),(i=t[2]>>m)<f?f=i:l<i&&(l=i)}),new _(u,a,h,c,f,l,e)),p=new w(function(t,o){return y.naturalOrder(t.count(),o.count())});function v(t,o){for(var n,r=t.size(),e=0;e<1e3;){if(o<=r)return;if(1e3<e++)return;if((n=t.pop()).count()){var i=function(t,h){if(h.count()){var o=h.r2-h.r1+1,n=h.g2-h.g1+1,r=y.max([o,n,h.b2-h.b1+1]);if(1==h.count())return[h.copy()];var c,e,i,u,f=0,l=[],p=[];if(r==o)for(c=h.r1;c<=h.r2;c++){for(u=0,e=h.g1;e<=h.g2;e++)for(i=h.b1;i<=h.b2;i++)u+=t[x(c,e,i)]||0;l[c]=f+=u}else if(r==n)for(c=h.g1;c<=h.g2;c++){for(u=0,e=h.r1;e<=h.r2;e++)for(i=h.b1;i<=h.b2;i++)u+=t[x(e,c,i)]||0;l[c]=f+=u}else for(c=h.b1;c<=h.b2;c++){for(u=0,e=h.r1;e<=h.r2;e++)for(i=h.g1;i<=h.g2;i++)u+=t[x(e,i,c)]||0;l[c]=f+=u}return l.forEach(function(t,o){p[o]=f-t}),function(t){var o,n,r,e,i,u=t+"1",s=t+"2",a=0;for(c=h[u];c<=h[s];c++)if(l[c]>f/2){for(r=h.copy(),e=h.copy(),i=(o=c-h[u])<=(n=h[s]-c)?Math.min(h[s]-1,~~(c+n/2)):Math.max(h[u],~~(c-1-o/2));!l[i];)i++;for(a=p[i];!a&&l[i-1];)a=p[--i];return r[s]=i,e[u]=r[s]+1,[r,e]}}(r==o?"r":r==n?"g":"b")}}(s,n),u=i[0],i=i[1];if(!u)return;t.push(u),i&&(t.push(i),r++)}else t.push(n),e++}}p.push(e),v(p,.75*o);for(var g=new w(function(t,o){return y.naturalOrder(t.count()*t.volume(),o.count()*o.volume())});p.size();)g.push(p.pop());v(g,o);for(var b=new C;g.size();)b.push(g.pop());return b});function x(t,o,n){return(t<<2*d)+(o<<d)+n}function w(t){var o=[],n=!1;function r(){o.sort(t),n=!0}return{push:function(t){o.push(t),n=!1},peek:function(t){return n||r(),void 0===t&&(t=o.length-1),o[t]},pop:function(){return n||r(),o.pop()},size:function(){return o.length},map:function(t){return o.map(t)},debug:function(){return n||r(),o}}}function _(t,o,n,r,e,i,u){this.r1=t,this.r2=o,this.g1=n,this.g2=r,this.b1=e,this.b2=i,this.histo=u}function C(){this.vboxes=new w(function(t,o){return y.naturalOrder(t.vbox.count()*t.vbox.volume(),o.vbox.count()*o.vbox.volume())})}r.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};function t(){}return t.prototype.getColor=function(t,o){return this.getPalette(t,5,o=void 0===o?10:o)[0]},t.prototype.getPalette=function(t,o,n){n=function(t){var o=t.colorCount,t=t.quality;if(void 0!==o&&Number.isInteger(o)){if(1===o)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");o=Math.max(o,2),o=Math.min(o,20)}else o=10;return{colorCount:o,quality:t=void 0===t||!Number.isInteger(t)||t<1?10:t}}({colorCount:o,quality:n}),t=new r(t),t=function(t,o,n){for(var r,e,i,u,s,a=t,h=[],c=0;c<o;c+=n)e=a[0+(r=4*c)],i=a[1+r],u=a[2+r],(void 0===(s=a[3+r])||125<=s)&&(250<e&&250<i&&250<u||h.push([e,i,u]));return h}(t.getImageData().data,t.width*t.height,n.quality),n=e(t,n.colorCount);return n?n.palette():null},t.prototype.getColorFromUrl=function(o,n,r){var e=this,i=document.createElement("img");i.addEventListener("load",function(){var t=e.getPalette(i,5,r);n(t[0],o)}),i.src=o},t.prototype.getImageData=function(t,e){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){if(200==this.status){var t=new Uint8Array(this.response);i=t.length;for(var o=new Array(i),n=0;n<t.length;n++)o[n]=String.fromCharCode(t[n]);var r=o.join(""),r=window.btoa(r);e("data:image/png;base64,"+r)}},o.send()},t.prototype.getColorAsync=function(t,n,r){var e=this;this.getImageData(t,function(t){var o=document.createElement("img");o.addEventListener("load",function(){var t=e.getPalette(o,5,r);n(t[0],this)}),o.src=t})},t});