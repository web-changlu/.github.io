"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var instance=null,timer=null,Timepiece=function(){function e(){_classCallCheck(this,e),_defineProperty(this,"ZHCNArr",["零","一","二","三","四","五","六","七","八","九","十"]),_defineProperty(this,"dateInfo",null),_defineProperty(this,"rotateInfo",null),_defineProperty(this,"$el",null),_defineProperty(this,"els",null),this.init()}return _createClass(e,[{key:"init",value:function(){if(timer)return timer;console.log("init timepiece...");var e=$("<ul><hr/></ul>");e[0].classList.add("clock"),e[0].setAttribute("id","helang-clock"),e.appendTo("#page-header"),this.$el=e,timer=this.$el,e=new Date,this.dateInfo={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),sec:e.getSeconds()},this.setDate(),this.setHour()}},{key:"changeZHCN",value:function(e){if(e<10)return this.ZHCNArr[e];var t=e.toString(),n="";return 0==t.charAt(1)?(n=1!=t.charAt(0)?this.ZHCNArr[parseInt(t.charAt(0),10)]:n)+this.ZHCNArr[10]:e<20?this.ZHCNArr[10]+this.ZHCNArr[parseInt(t.charAt(1),10)]:this.ZHCNArr[parseInt(t.charAt(0),10)]+this.ZHCNArr[10]+this.ZHCNArr[parseInt(t.charAt(1),10)]}},{key:"setDate",value:function(){for(var e,t,n="",i=this.dateInfo.year.toString(),r=0;r<i.length;r++)n+=this.changeZHCN(parseInt(i.charAt(r),10));e=this.changeZHCN(this.dateInfo.month),t=this.changeZHCN(this.dateInfo.day),this.els?this.els.date.html(n+"年"+e+"月"+t+"日"):this.$el.append('<li class="date">'+n+"年"+e+"月"+t+"日</li>")}},{key:"setHour",value:function(){for(var e=this,t="",n=[],i=1;i<=24;i++)n.push(15*(i-1)*-1),t+="<div><div>"+this.changeZHCN(i)+"时</div></div>";this.$el.append('<li class="hour on-hour">'+t+"</li>"),setTimeout(function(){e.$el.find(".on-hour>div").each(function(e,t){$(t).css({transform:"rotate("+n[e]+"deg)"})}),setTimeout(function(){e.setMinute()},300)},100)}},{key:"setMinute",value:function(){for(var e=this,t="",n=[],i=1;i<=60;i++)n.push(6*(i-1)*-1),t+="<div><div>"+this.changeZHCN(i)+"分</div></div>";this.$el.append('<li class="hour minute on-minute">'+t+"</li>"),setTimeout(function(){e.$el.find(".on-minute>div").each(function(e,t){$(t).css({transform:"rotate("+n[e]+"deg)"})}),setTimeout(function(){e.setSec()},300)},100)}},{key:"setSec",value:function(){for(var e=this,t="",n=[],i=1;i<=60;i++)n.push(6*(i-1)*-1),t+="<div><div>"+this.changeZHCN(i)+"秒</div></div>";this.$el.append('<li class="hour sec on-sec">'+t+"</li>"),setTimeout(function(){e.$el.find(".on-sec>div").each(function(e,t){$(t).css({transform:"rotate("+n[e]+"deg)"})}),setTimeout(function(){e.initRotate()},1300)},100)}},{key:"initRotate",value:function(){var e=this;this.rotateInfo={h:15*(this.dateInfo.hour-1),m:6*(this.dateInfo.minute-1),s:6*(this.dateInfo.sec-1)},this.els={date:this.$el.find(".date"),hour:this.$el.find(".on-hour"),minute:this.$el.find(".on-minute"),sec:this.$el.find(".on-sec")},this.els.hour.css({transform:"rotate("+this.rotateInfo.h+"deg)"}),this.els.minute.css({transform:"rotate("+this.rotateInfo.m+"deg)"}),this.els.sec.css({transform:"rotate("+this.rotateInfo.s+"deg)"}),setTimeout(function(){e.$el.find("hr").addClass("active").css({width:"105%"}),e.start()},300)}},{key:"start",value:function(){var t=this;setTimeout(function(){var e;t.dateInfo.sec<=60?(t.dateInfo.sec++,e=6*(t.dateInfo.sec-1),t.els.sec.css({transform:"rotate("+e+"deg)"}),t.minuteAdd(),t.start()):console.log(t.dateInfo.sec)},1e3)}},{key:"minuteAdd",value:function(){var t=this;61==this.dateInfo.sec&&setTimeout(function(){t.els.sec.css({transform:"rotate(0deg)","transition-duration":"0s"}),t.dateInfo.sec=1,setTimeout(function(){t.els.sec.attr("style","transform:rotate(0deg)")},100),t.dateInfo.minute++;var e=6*(t.dateInfo.minute-1);t.els.minute.css({transform:"rotate("+e+"deg)"}),t.hourAdd()},300)}},{key:"hourAdd",value:function(){var t=this;61==this.dateInfo.minute&&setTimeout(function(){t.els.minute.css({transform:"rotate(0deg)","transition-duration":"0s"}),t.dateInfo.minute=1,setTimeout(function(){t.els.minute.attr("style","transform:rotate(0deg)")},100),t.dateInfo.hour++;var e=15*(t.dateInfo.hour-1);t.els.hour.css({transform:"rotate("+e+"deg)"}),t.dayAdd()},300)}},{key:"dayAdd",value:function(){var t=this;25==this.dateInfo.hour&&setTimeout(function(){t.els.hour.css({transform:"rotate(0deg)","transition-duration":"0s"}),t.dateInfo.hour=1,setTimeout(function(){t.els.hour.attr("style","transform:rotate(0deg)")},100);var e=new Date;t.dateInfo.year=e.getFullYear(),t.dateInfo.month=e.getMonth()+1,t.dateInfo.day=e.getDate(),t.setDate()},300)}}]),e}(),MyEvents=function(){function e(){if(_classCallCheck(this,e),instance)return instance;(instance=this).init()}return _createClass(e,[{key:"init",value:function(){var e=this;console.log("init user events"),this.checkPageSize(),$(window).resize(function(){e.checkPageSize()})}},{key:"checkPageSize",value:function(){$(window).width()<=720?(timer&&(timer.remove(),timer=null),$("#page-header").attr("page-size","min")):(new Timepiece,$("#page-header").attr("page-size","normal"))}}]),e}(),PWA=function(){function e(){_classCallCheck(this,e),this.insertDom(),"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",function(){var e,t;GLOBAL_CONFIG.Snackbar?(e="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,t=GLOBAL_CONFIG.Snackbar.position,Snackbar.show({text:"已更新最新版本",backgroundColor:e,duration:5e5,pos:t,actionText:"点击刷新",actionTextColor:"#fff",onActionClick:function(e){location.reload()}})):(t="light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f",t="top: 0; background: ".concat(t,";"),document.getElementById("app-refresh").style.cssText=t)}),window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js")}))}return _createClass(e,[{key:"insertDom",value:function(){$('<div class="app-refresh" id="app-refresh">\n        <div class="app-refresh-wrap">\n          <label>✨ 网站已更新最新版本 👉</label>\n          <a href="javascript:void(0)" onclick="location.reload()">点击刷新</a>\n        </div>\n      </div>').appendTo("body")}}]),e}();btf.isJqueryLoad(function(){new MyEvents,new PWA});